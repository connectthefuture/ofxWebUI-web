/*
 * Copyright Paul Reimer, 2012
 *
 * This work is licensed under the Creative Commons Attribution-NonCommercial 3.0 Unported License.
 * To view a copy of this license, visit
 * http://creativecommons.org/licenses/by-nc/3.0/
 * or send a letter to
 * Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.
 */

field_templates["text-field-template"]=function(b){var a=' <div data-role="fieldcontain"> <label for="'+(b.name)+'">'+(b.title)+':</label> <input class="'+(b.options.template)+'-field" type="'+(b.options.type)+'" name="'+(b.name)+'" id="'+(b.name)+'" ';if("default_value" in b.options){a+='value="'+(b.options.default_value)+'"'}a+=" /> </div> ";return a};field_templates["slider-field-template"]=function(b){var a=' <div data-role="fieldcontain"> <label for="'+(b.name)+'">'+(b.title)+':</label> <input class="'+(b.options.template)+'-field" type="range" name="'+(b.name)+'" id="'+(b.name)+'" step="'+(b.options.step)+'" ';if("default_value" in b.options){a+='value="'+(b.options.default_value)+'"'}a+=' min="'+(b.options.min)+'" max="'+(b.options.max)+'" /> </div> ';return a};field_templates["radio-field-template"]=function(e){var d=' <div data-role="fieldcontain"> <fieldset data-role="controlgroup" id="'+(e.name)+'"> <legend>'+(e.title)+"</legend> ";var c=e.options.choices;if(c){var a=-1,b=c.length-1;while(a<b){choice=c[a+=1];d+=' <input class="'+(e.options.template)+'-field" type="radio" name="'+(e.name)+"_"+(a)+'" id="'+(e.name)+"_"+(a)+'" value="'+(a)+'" /> <label for="'+(e.name)+"_"+(a)+'">'+(choice)+"</label> "}}d+=" </fieldset> </div> ";return d};field_templates["imagemap-field-template"]=function(e){var d=' <div data-role="fieldcontain"> <fieldset data-role="controlgroup" id="'+(e.name)+'"> <legend>'+(e.title)+'</legend> <ul data-role="listview"> ';var c=e.options.choices;if(c){var a=-1,b=c.length-1;while(a<b){item=c[a+=1];d+=' <li class="'+(e.options.template)+'-field"> <a href="#"> <img src="'+(item.image)+'" /> <h3>'+(item.title)+"</h3> <p>"+(item.title)+"</p> </a> </li> "}}d+=" </ul> </fieldset> </div> ";return d};field_templates["imagelist-field-template"]=function(e){var d=' <div data-role="fieldcontain"> <fieldset data-role="controlgroup" id="'+(e.name)+'"> <legend>'+(e.title)+'</legend> <ul data-role="listview"> ';var c=e.options.choices;if(c){var a=-1,b=c.length-1;while(a<b){item=c[a+=1];d+=' <li class="'+(e.options.template)+'-field"> <a href="#"> <img class="thumbnail" id="thumbnail-'+(a)+'" src="http://sign-cdn.limbicmedia.ca/blank.gif" /> <h3>'+(item.title)+"</h3> <p>"+(item.title)+"</p> </a> </li> "}}d+=" </ul> </fieldset> </div> ";return d};field_templates["toggle-field-template"]=function(b){var a=' <div data-role="fieldcontain"> <label for="'+(b.name)+'">'+(b.title)+'</label> <select class="'+(b.options.template)+'-field" data-role="slider" name="'+(b.name)+'" id="'+(b.name)+'" > <option value="0">Off</option> <option value="1">On</option> </select> </div> ';return a};field_templates["color-field-template"]=function(b){var a=' <div data-role="fieldcontain"> <label for="'+(b.name)+'">'+(b.title)+'</label> <input class="'+(b.options.template)+'-field" type="text" name="'+(b.name)+'" id="'+(b.name)+'" ';if("default_value" in b.options){a+='value="'+(b.options.default_value)+'"'}else{a+=' value="#000000" '}a+=' /> <div class="colorpicker"></div> </div> ';return a};group_templates["list-group-template"]=function(b){var a=' <ul data-role="listview" class="'+(b.options.template)+'-group" > <li> <h1>'+(b.title)+"</h1> "+(b.content)+" </li> </ul> ";return a};group_templates["page-group-template"]=function(b){var a=' <div data-role="page" id="'+(b.name)+'" class="'+(b.options.template)+'-group" > <div data-role="header"> <h1>'+(b.title)+'</h1> </div> <div data-role="content"> '+(b.content)+' </div> <div data-role="footer"> </div> </div> ';return a};group_templates["collapsible-group-template"]=function(b){var a=' <div data-role="collapsible" class="'+(b.options.template)+'-group" > <h3>'+(b.title)+"</h3> "+(b.content)+" </div> ";return a};function get_value_from_field(c,b,a){var d=undefined;switch(b){case"color":d=parseInt(c.val().replace("#","0x"));break;case"radio":var d=-1;jQuery('input[type="radio"]',c).each(function(e,f){var g=(c.attr("id")===a);c.attr("checked",g).checkboxradio("refresh");if(g){d=e}});d=d;break;case"toggle":d=(jQuery("select",c)[0].selectedIndex>0);break;case"text":case"slider":d=c.val();break;case"imagemap":d=c.index();break;case"imagelist":d=c.index();break;default:d=c.value;break}return d}function set_field_from_value(c,b,d){switch(b){case"color":var a="#"+d.toString(16);jQuery.farbtastic(c.next(".colorpicker")).setColor(a);break;case"toggle":c[0].selectedIndex=d?1:0;c.slider("refresh");break;case"radio":var e=jQuery('input[type="radio"]',c);jQuery.each(e,function(f,g){var h=(g.id().lastIndexOf("_"+d)!=-1);g.attr("checked",h)});e.checkboxradio("refresh");break;case"slider":c.val(d).slider("refresh");break;case"text":c.val(d);break;case"imagemap":console.log("Received broadcast for unknown field type: imagemap");break;case"imagelist":console.log("Received broadcast for unknown field type: imagelist");break;default:c.value=d;break}}function get_appropriate_ws_url(b){var e;var d=document.URL;if(d.substring(0,5)=="https"){e="wss://";d=d.substr(8)}else{e="ws://";if(d.substring(0,4)=="http"){d=d.substr(7)}}d=d.split("/");var c;if(b!==undefined){var a=d[0].split(":");c=a[0]+":"+b}else{c=d[0]}return e+c};jQuery(document).bind("mobileinit",function(){var c=jQuery("#form"),e=/\s*([^\s]+)-field/,d=new protobuf.ui,f=function(j,l){if(l==="."){l=""}var g=[];for(var i in j.properties_){var k=j.properties_[i].type();switch(k){default:var q=j.properties_[i].options||{},h=q.template+"-group-template";if(h in group_templates){var n={title:i,name:l+i,options:q,content:f(k,l+i+".")},p=group_templates[h](n);g.push(p)}break;case PROTO.bytes:case PROTO.array:break;case PROTO.uint32:case PROTO.sfixed32:case PROTO.fixed32:case PROTO.int32:case PROTO.sint32:case PROTO.uint32:case PROTO.uint64:case PROTO.sfixed64:case PROTO.fixed64:case PROTO.int64:case PROTO.sint64:case PROTO.uint64:case PROTO.Float:case PROTO.Double:case PROTO.bool:case PROTO.string:var q=j.properties_[i].options||{},m={title:i,name:l+i,options:q},h=q.template+"-field-template";if(h in field_templates){var o=field_templates[h](m);g.push(o)}break}}return g.join("")};var b=f(d,"");jQuery(b).appendTo(c);var a=function(t){if(!live||!ws){return}var r=new protobuf.ui,k=useBinary?new PROTO.ByteArrayStream:new PROTO.Base64Stream,u=jQuery(t.target),q=u.closest("div[data-role='fieldcontain']"),o=jQuery("input",q),m=(o.length&&o||u.closest("li.imagemap-field,li.imagelist-field")),j=(m.attr("name")&&m.attr("name").split(".")||q&&jQuery("fieldset",q)[0].id.split(".")),p=e.exec(m.attr("class"));if(p.length>1){var s=p[1],h=r,g=j.length;for(var l=0;l<(g-1);l++){h=h[j[l]]}h[j[g-1]]=get_value_from_field(m,s,t.target.id);r.SerializeToStream(k);if(useBinary){var v=new Uint8Array(k.getArray());ws.send(v.buffer)}else{ws.send(k.getString())}}};jQuery("div[data-role='fieldcontain']",c).on("change",a);jQuery("div[data-role='fieldcontain'] li",c).on("click",a);jQuery(".colorpicker").each(function(){jQuery(this).farbtastic({callback:jQuery(this).prev("input"),width:200})})});jQuery(document).bind("pageinit",function(){var d=jQuery("#ws_url");var e=" | ";var c=document.title;if(document.title.indexOf(e)>=0){c=document.title.split(e)[0]}var b=function(){try{if(ws.readyState!==ws.CLOSING&&ws.readyState!==ws.CLOSED){ws.close(0)}}catch(f){console.log("Error"+f)}};var a=function(){var g=get_appropriate_ws_url();try{if(window.MozWebSocket){ws=new MozWebSocket(g,"ofx")}else{if(window.WebSocket){ws=new WebSocket(g,"ofx")}else{return}}if(ws.binaryType){useBinary=false;ws.binaryType="arraybuffer"}ws.onopen=function(){d.attr("data-theme","d").click(b);jQuery(".ui-icon",d).addClass("ui-icon-check").removeClass("ui-icon-refresh");jQuery(".ui-btn-text",d).text(g);jQuery("#ws_status").text("Connected");document.title=c+e+"Connected"};ws.onmessage=function(p){var l=new protobuf.ui;var o;if(useBinary){var j=new Uint8Array(p.data);var h=[];for(var k=0,q=j.length;k<q;++k){h.push(j[k])}o=new PROTO.ByteArrayStream(h)}else{o=new PROTO.Base64Stream(p.data)}l.ParseFromStream(o);live=false;var m=function(t,i){if(i==="."){i=""}for(var s in t.values_){var r=jQuery(document.getElementById(i+s)),n=t.properties_[s].options,u=n.template+"-group-template";if(r){if(u in group_templates){m(t.values_[s],i+s+".")}else{set_field_from_value(r,n.template,t.values_[s])}}}};m(l,"");live=true};ws.onclose=function(){d.attr("data-theme","b").click(a);jQuery(".ui-icon",d).addClass("ui-icon-refresh").removeClass("ui-icon-check");jQuery(".ui-btn-text",d).text("Reconnect");jQuery("#ws_status").text("Disconnected");document.title=c+e+"Disconnected"}}catch(f){console.log("Error"+f)}};a();d.click(a)});